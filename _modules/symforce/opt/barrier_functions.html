
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>symforce.opt.barrier_functions &#8212; symforce 0.8.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for symforce.opt.barrier_functions</h1><div class="highlight"><pre>
<span></span><span class="c1"># ----------------------------------------------------------------------------</span>
<span class="c1"># SymForce - Copyright 2022, Skydio, Inc.</span>
<span class="c1"># This source code is under the Apache 2.0 license found in the LICENSE file.</span>
<span class="c1"># ----------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">symforce.symbolic</span> <span class="k">as</span> <span class="nn">sf</span>


<div class="viewcode-block" id="max_power_barrier"><a class="viewcode-back" href="../../../api/symforce.opt.barrier_functions.html#symforce.opt.barrier_functions.max_power_barrier">[docs]</a><span class="k">def</span> <span class="nf">max_power_barrier</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">x_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">error_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">dist_zero_to_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">power</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A one-sided, non-symmetric scalar barrier function. The barrier passes through the points</span>
<span class="sd">    (x_nominal, error_nominal) and (x_nominal - dist_zero_to_nominal, 0) with a curve of the</span>
<span class="sd">    form x^power. The parameterization of the barrier by these variables is convenient because it</span>
<span class="sd">    allows setting a constant penalty for a nominal point, then adjusting the `width` and</span>
<span class="sd">    `steepness` of the curve independently. The barrier with power = 1 will look like:</span>

<span class="sd">                                 |              **</span>
<span class="sd">                                 |             ** - (x_nominal, error_nominal) is a fixed point</span>
<span class="sd">                                 |            **</span>
<span class="sd">                                 |           **   &lt;- x^power is the shape of the curve</span>
<span class="sd">                                 |          **</span>
<span class="sd">                                 |         **</span>
<span class="sd">             ----------*********************---------</span>
<span class="sd">                                 |         |&lt;--&gt;| dist_zero_to_nominal is the distance from</span>
<span class="sd">                                                  x_nominal to the point at which the error is zero</span>

<span class="sd">    Note that when applying the barrier function to a residual used in a least-squares problem, a</span>
<span class="sd">    power = 1 will lead to a quadratic cost in the optimization problem because the cost</span>
<span class="sd">    equals 1/2 * residual^2. For example:</span>

<span class="sd">    Cost (1/2 * residual^2) when the residual is a max_power_barrier with power = 1 (shown above):</span>

<span class="sd">                                |                *</span>
<span class="sd">                                |               ** - (x_nominal, error_nominal^2)</span>
<span class="sd">                                |               *</span>
<span class="sd">                                |              ** &lt;- x^(2*power) is the shape of the cost curve</span>
<span class="sd">                                |            ***</span>
<span class="sd">                                |          ***</span>
<span class="sd">             ---------*********************---------</span>
<span class="sd">                                |         |&lt;--&gt;| dist_zero_to_nominal</span>

<span class="sd">    Args:</span>
<span class="sd">        x: The point at which we want to evaluate the barrier function.</span>
<span class="sd">        x_nominal: x-value of the point at which the error is equal to error_nominal.</span>
<span class="sd">        error_nominal: Error returned when x equals x_nominal.</span>
<span class="sd">        dist_zero_to_nominal: The distance from x_nominal to the region of zero error. Must be</span>
<span class="sd">            a positive number.</span>
<span class="sd">        power: The power used to describe the curve of the error tails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_zero_error</span> <span class="o">=</span> <span class="n">x_nominal</span> <span class="o">-</span> <span class="n">dist_zero_to_nominal</span>
    <span class="k">return</span> <span class="n">error_nominal</span> <span class="o">*</span> <span class="n">sf</span><span class="o">.</span><span class="n">Pow</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x_zero_error</span><span class="p">)</span> <span class="o">/</span> <span class="n">dist_zero_to_nominal</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span></div>


<div class="viewcode-block" id="max_linear_barrier"><a class="viewcode-back" href="../../../api/symforce.opt.barrier_functions.html#symforce.opt.barrier_functions.max_linear_barrier">[docs]</a><span class="k">def</span> <span class="nf">max_linear_barrier</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span> <span class="n">x_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span> <span class="n">error_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span> <span class="n">dist_zero_to_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies &quot;max_power_barrier&quot; with power = 1.  When applied to a residual of a least-squares</span>
<span class="sd">    problem, this produces a quadratic cost in the optimization problem because</span>
<span class="sd">    cost = 1/2 * residual^2. See &quot;max_power_barrier&quot; for more details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">max_power_barrier</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">x_nominal</span><span class="o">=</span><span class="n">x_nominal</span><span class="p">,</span>
        <span class="n">error_nominal</span><span class="o">=</span><span class="n">error_nominal</span><span class="p">,</span>
        <span class="n">dist_zero_to_nominal</span><span class="o">=</span><span class="n">dist_zero_to_nominal</span><span class="p">,</span>
        <span class="n">power</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="min_power_barrier"><a class="viewcode-back" href="../../../api/symforce.opt.barrier_functions.html#symforce.opt.barrier_functions.min_power_barrier">[docs]</a><span class="k">def</span> <span class="nf">min_power_barrier</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">x_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">error_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">dist_zero_to_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">power</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A one-sided, non-symmetric scalar barrier function. The barrier passes through the points</span>
<span class="sd">    (x_nominal, error_nominal) and (x_nominal + dist_zero_to_nominal, 0) with a curve of the</span>
<span class="sd">    form x^power. The barrier with power = 1 will look like:</span>

<span class="sd">                                        **               |</span>
<span class="sd">            (x_nominal, error_nominal) - **              |</span>
<span class="sd">                                          **             |</span>
<span class="sd">    x^power is the shape of the curve -&gt;   **            |</span>
<span class="sd">                                            **           |</span>
<span class="sd">                                             **          |</span>
<span class="sd">                                     ---------**********************---------</span>
<span class="sd">                    dist_zero_to_nominal  |&lt;-&gt;|          |</span>

<span class="sd">    Args:</span>
<span class="sd">        x: The point at which we want to evaluate the barrier function.</span>
<span class="sd">        x_nominal: x-value of the point at which the error is equal to error_nominal.</span>
<span class="sd">        error_nominal: Error returned when x equals x_nominal.</span>
<span class="sd">        dist_zero_to_nominal: The distance from x_nominal to the region of zero error. Must be</span>
<span class="sd">            a positive number.</span>
<span class="sd">        power: The power used to describe the curve of the error tails. Note that</span>
<span class="sd">            when applying the barrier function to a residual used in a least-squares problem,</span>
<span class="sd">            a power = 1 will lead to a quadratic cost in the optimization problem.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Flip x and x_nominal about the y-axis and reuse the max_power_barrier implementation</span>
    <span class="k">return</span> <span class="n">max_power_barrier</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=-</span><span class="n">x</span><span class="p">,</span>
        <span class="n">x_nominal</span><span class="o">=-</span><span class="n">x_nominal</span><span class="p">,</span>
        <span class="n">error_nominal</span><span class="o">=</span><span class="n">error_nominal</span><span class="p">,</span>
        <span class="n">dist_zero_to_nominal</span><span class="o">=</span><span class="n">dist_zero_to_nominal</span><span class="p">,</span>
        <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="min_linear_barrier"><a class="viewcode-back" href="../../../api/symforce.opt.barrier_functions.html#symforce.opt.barrier_functions.min_linear_barrier">[docs]</a><span class="k">def</span> <span class="nf">min_linear_barrier</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span> <span class="n">x_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span> <span class="n">error_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span> <span class="n">dist_zero_to_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies &quot;min_power_barrier&quot; with power = 1.  When applied to a residual of a least-squares</span>
<span class="sd">    problem, this produces a quadratic cost in the optimization problem because</span>
<span class="sd">    cost = 1/2 * residual^2. See &quot;min_power_barrier&quot; for more details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">min_power_barrier</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">x_nominal</span><span class="o">=</span><span class="n">x_nominal</span><span class="p">,</span>
        <span class="n">error_nominal</span><span class="o">=</span><span class="n">error_nominal</span><span class="p">,</span>
        <span class="n">dist_zero_to_nominal</span><span class="o">=</span><span class="n">dist_zero_to_nominal</span><span class="p">,</span>
        <span class="n">power</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="symmetric_power_barrier"><a class="viewcode-back" href="../../../api/symforce.opt.barrier_functions.html#symforce.opt.barrier_functions.symmetric_power_barrier">[docs]</a><span class="k">def</span> <span class="nf">symmetric_power_barrier</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">x_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">error_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">dist_zero_to_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">power</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A symmetric barrier cenetered around x = 0, meaning the error at -x is equal to the error at x.</span>
<span class="sd">    The barrier passes through the points (x_nominal, error_nominal) and</span>
<span class="sd">    (x_nominal - dist_zero_to_nominal, 0) with a curve of the form x^power. For example, the</span>
<span class="sd">    barrier with power = 1 will look like:</span>

<span class="sd">                 **              |              **</span>
<span class="sd">                  **             |             ** - (x_nominal, error_nominal) is a fixed point</span>
<span class="sd">                   **            |            **</span>
<span class="sd">                    **           |           **   &lt;- x^power is the shape of the curve</span>
<span class="sd">                     **          |          **</span>
<span class="sd">                      **         |         **</span>
<span class="sd">             ----------*********************---------</span>
<span class="sd">                                 |         |&lt;--&gt;| dist_zero_to_nominal is the distance from</span>
<span class="sd">                                                  x_nominal to the point at which the error is zero</span>

<span class="sd">    Note that when applying the barrier function to a residual used in a least-squares problem, a</span>
<span class="sd">    power = 1 will lead to a quadratic cost in the optimization problem because the cost</span>
<span class="sd">    equals 1/2 * residual^2. For example:</span>

<span class="sd">    Cost (1/2 * residual^2) when the residual is a symmetric barrier with power = 1 (shown above):</span>

<span class="sd">               *                |                *</span>
<span class="sd">               **               |               ** - (x_nominal, 1/2 * error_nominal^2)</span>
<span class="sd">                *               |               *</span>
<span class="sd">                **              |              ** &lt;- x^(2*power) is the shape of the cost curve</span>
<span class="sd">                 ***            |            ***</span>
<span class="sd">                   ***          |          ***</span>
<span class="sd">             ---------*********************---------</span>
<span class="sd">                                |         |&lt;--&gt;| dist_zero_to_nominal</span>

<span class="sd">    Args:</span>
<span class="sd">        x: The point at which we want to evaluate the barrier function.</span>
<span class="sd">        x_nominal: x-value of the point at which the error is equal to error_nominal.</span>
<span class="sd">        error_nominal: Error returned when x equals x_nominal.</span>
<span class="sd">        dist_zero_to_nominal: Distance from x_nominal to the closest point at which the error is</span>
<span class="sd">            zero. Note that dist_zero_to_nominal must be less than x_nominal and greater than zero.</span>
<span class="sd">        power: The power used to describe the curve of the error tails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">max_power_barrier</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">sf</span><span class="o">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="n">x_nominal</span><span class="o">=</span><span class="n">x_nominal</span><span class="p">,</span>
        <span class="n">error_nominal</span><span class="o">=</span><span class="n">error_nominal</span><span class="p">,</span>
        <span class="n">dist_zero_to_nominal</span><span class="o">=</span><span class="n">dist_zero_to_nominal</span><span class="p">,</span>
        <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="min_max_power_barrier"><a class="viewcode-back" href="../../../api/symforce.opt.barrier_functions.html#symforce.opt.barrier_functions.min_max_power_barrier">[docs]</a><span class="k">def</span> <span class="nf">min_max_power_barrier</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">x_nominal_lower</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">x_nominal_upper</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">error_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">dist_zero_to_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">power</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A symmetric barrier centered between x_nominal_lower and x_nominal_upper. See</span>
<span class="sd">    symmetric_power_barrier for a detailed description of the barrier function.</span>
<span class="sd">    As an example, the barrier with power = 1 will look like:</span>

<span class="sd">                                     **          |              **</span>
<span class="sd">                                      **         |             **</span>
<span class="sd">    (x_nominal_lower, error_nominal) - **        |            ** - (x_nominal_upper, error_nominal)</span>
<span class="sd">                                        **       |           **</span>
<span class="sd">                                         **      |          ** &lt;- x^power is the shape of the curve</span>
<span class="sd">                                          **     |         **</span>
<span class="sd">                                 ----------*****************---------</span>
<span class="sd">                  dist_zero_to_nominal |&lt;-&gt;|     |         |&lt;-&gt;| dist_zero_to_nominal</span>

<span class="sd">    Args:</span>
<span class="sd">        x: The point at which we want to evaluate the barrier function.</span>
<span class="sd">        x_nominal_lower: x-value of the point at which the error is equal to error_nominal on</span>
<span class="sd">            the left-hand side of the barrier function.</span>
<span class="sd">        x_nominal_upper: x-value of the point at which the error is equal to error_nominal on</span>
<span class="sd">            the right-hand side of the barrier function.</span>
<span class="sd">        error_nominal: Error returned when x equals x_nominal_lower or x_nominal_upper.</span>
<span class="sd">        dist_zero_to_nominal: The distance from either of the x_nominal points to the region of</span>
<span class="sd">            zero error. Must be less than half the distance between x_nominal_lower and</span>
<span class="sd">            x_nominal_upper, and must be greater than zero.</span>
<span class="sd">        power: The power used to describe the curve of the error tails. Note that</span>
<span class="sd">            when applying the barrier function to a residual used in a least-squares problem,</span>
<span class="sd">            a power = 1 will lead to a quadratic cost in the optimization problem.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_nominal_lower</span> <span class="o">+</span> <span class="n">x_nominal_upper</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">x_shifted</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">center</span>
    <span class="n">x_nominal_shifted</span> <span class="o">=</span> <span class="n">x_nominal_upper</span> <span class="o">-</span> <span class="n">center</span>
    <span class="k">return</span> <span class="n">symmetric_power_barrier</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x_shifted</span><span class="p">,</span>
        <span class="n">x_nominal</span><span class="o">=</span><span class="n">x_nominal_shifted</span><span class="p">,</span>
        <span class="n">error_nominal</span><span class="o">=</span><span class="n">error_nominal</span><span class="p">,</span>
        <span class="n">dist_zero_to_nominal</span><span class="o">=</span><span class="n">dist_zero_to_nominal</span><span class="p">,</span>
        <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="min_max_linear_barrier"><a class="viewcode-back" href="../../../api/symforce.opt.barrier_functions.html#symforce.opt.barrier_functions.min_max_linear_barrier">[docs]</a><span class="k">def</span> <span class="nf">min_max_linear_barrier</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">x_nominal_lower</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">x_nominal_upper</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">error_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">dist_zero_to_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies &quot;min_max_power_barrier&quot; with power = 1. When applied to a residual of a least-squares</span>
<span class="sd">    problem, this produces a quadratic cost in the optimization problem because</span>
<span class="sd">    cost = 1/2 * residual^2. See &quot;min_max_power_barrier&quot; for more details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">min_max_power_barrier</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">x_nominal_lower</span><span class="o">=</span><span class="n">x_nominal_lower</span><span class="p">,</span>
        <span class="n">x_nominal_upper</span><span class="o">=</span><span class="n">x_nominal_upper</span><span class="p">,</span>
        <span class="n">error_nominal</span><span class="o">=</span><span class="n">error_nominal</span><span class="p">,</span>
        <span class="n">dist_zero_to_nominal</span><span class="o">=</span><span class="n">dist_zero_to_nominal</span><span class="p">,</span>
        <span class="n">power</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="min_max_centering_power_barrier"><a class="viewcode-back" href="../../../api/symforce.opt.barrier_functions.html#symforce.opt.barrier_functions.min_max_centering_power_barrier">[docs]</a><span class="k">def</span> <span class="nf">min_max_centering_power_barrier</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">x_nominal_lower</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">x_nominal_upper</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">error_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">dist_zero_to_nominal</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">power</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
    <span class="n">centering_scale</span><span class="p">:</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sf</span><span class="o">.</span><span class="n">Scalar</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This barrier is the maximum of two power barriers which we call the &quot;bounding&quot; barrier</span>
<span class="sd">    and the &quot;centering&quot; barrier. Both barriers are centered between x_nominal_lower and</span>
<span class="sd">    x_nominal_upper. As an example, the barrier with power = 1 may look like:</span>

<span class="sd">    BARRIER (max of bounding and centering barriers):</span>
<span class="sd">                   **              |                          **</span>
<span class="sd">                    ** &lt;-(x_nominal_lower, error_nominal)    ** &lt;-(x_nominal_upper, error_nominal)</span>
<span class="sd">                     **            |                        **</span>
<span class="sd">                      **           |                       **</span>
<span class="sd">                       ******      |                  ******</span>
<span class="sd">                            ****** |             ****** &lt;- x^power is the shape of upper/lower curve</span>
<span class="sd">                                 ******     ******</span>
<span class="sd">                    ------------------*******-------------------</span>
<span class="sd">                                   |</span>

<span class="sd">    It may be easier to vizualize the bounding and centering barriers independently:</span>

<span class="sd">    BOUNDING BARRIER:</span>
<span class="sd">                   **              |                          **</span>
<span class="sd">                    ** &lt;-(x_nominal_lower, error_nominal)    ** &lt;-(x_nominal_upper, error_nominal)</span>
<span class="sd">                     **            |                        **</span>
<span class="sd">                      **           |                       **</span>
<span class="sd">                       **          |                      ** &lt;- x^power is the shape of the curve</span>
<span class="sd">                        **         |                     **</span>
<span class="sd">                         **        |                    **</span>
<span class="sd">                    ------*******************************-------</span>
<span class="sd">                                   |                   |&lt;--&gt;| dist_zero_to_nominal</span>

<span class="sd">    CENTERING BARRIER:</span>
<span class="sd">                                   |</span>
<span class="sd">                                   |</span>
<span class="sd">             ******                |                            ******</span>
<span class="sd">                  ******           |                       ******</span>
<span class="sd">       nominal_lower ^ ******      |                  ****** ^ nominal_upper</span>
<span class="sd">                            ****** |             ******</span>
<span class="sd">                                 ******     ******  &lt;- x^power is the shape of the curve</span>
<span class="sd">                    ------------------*******-------------------</span>
<span class="sd">                                   |     ^-((x_nominal_lower + x_nominal_upper) / 2, 0)</span>
<span class="sd">    where:</span>
<span class="sd">        nominal_lower = (x_nominal_lower, centering_scale * error_nominal)</span>
<span class="sd">        nominal_upper = (x_nominal_upper, centering_scale * error_nominal)</span>
<span class="sd">    and the only point with zero error is the midpoint of x_nominal_lower and x_nominal_upper.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: The point at which we want to evaluate the barrier function.</span>
<span class="sd">        x_nominal_lower: x-value of the point at which the error is equal to error_nominal on</span>
<span class="sd">            the left-hand side of the barrier function.</span>
<span class="sd">        x_nominal_upper: x-value of the point at which the error is equal to error_nominal on</span>
<span class="sd">            the right-hand side of the barrier function.</span>
<span class="sd">        error_nominal: Error returned when x equals x_nominal_lower or x_nominal_upper.</span>
<span class="sd">        dist_zero_to_nominal: Used with the &quot;bounding barrier&quot; to define the distance from either</span>
<span class="sd">            of the x_nominal points to the region of zero error. Must be less than half the</span>
<span class="sd">            distance between x_nominal_lower and x_nominal_upper, and must be greater than zero.</span>
<span class="sd">        power: The power used to describe the curve of the error tails. Note that</span>
<span class="sd">            when applying the barrier function to a residual used in a least-squares problem,</span>
<span class="sd">            a power = 1 will lead to a quadratic cost in the optimization problem.</span>
<span class="sd">        centering_scale: Used to define the shape of the &quot;centering barrier&quot;. Must be between</span>
<span class="sd">            zero and one. The centering barrier passes through (x_nominal_lower,</span>
<span class="sd">            centering_scale * error_nominal), ((x_nominal_lower + x_nominal_upper) / 2, 0),</span>
<span class="sd">            and (x_nominal_upper, centering_scale * error_nominal).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bounding_barrier</span> <span class="o">=</span> <span class="n">min_max_power_barrier</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">x_nominal_lower</span><span class="o">=</span><span class="n">x_nominal_lower</span><span class="p">,</span>
        <span class="n">x_nominal_upper</span><span class="o">=</span><span class="n">x_nominal_upper</span><span class="p">,</span>
        <span class="n">error_nominal</span><span class="o">=</span><span class="n">error_nominal</span><span class="p">,</span>
        <span class="n">dist_zero_to_nominal</span><span class="o">=</span><span class="n">dist_zero_to_nominal</span><span class="p">,</span>
        <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_nominal_lower</span> <span class="o">+</span> <span class="n">x_nominal_upper</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">centering_barrier</span> <span class="o">=</span> <span class="n">min_max_power_barrier</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">x_nominal_lower</span><span class="o">=</span><span class="n">x_nominal_lower</span><span class="p">,</span>
        <span class="n">x_nominal_upper</span><span class="o">=</span><span class="n">x_nominal_upper</span><span class="p">,</span>
        <span class="n">error_nominal</span><span class="o">=</span><span class="n">centering_scale</span> <span class="o">*</span> <span class="n">error_nominal</span><span class="p">,</span>
        <span class="n">dist_zero_to_nominal</span><span class="o">=</span><span class="n">x_nominal_upper</span> <span class="o">-</span> <span class="n">center</span><span class="p">,</span>
        <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">sf</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="n">bounding_barrier</span><span class="p">,</span> <span class="n">centering_barrier</span><span class="p">)</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">symforce</a></h1>



<p class="blurb">Fast symbolic computation, code generation, and nonlinear optimization for robotics</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=symforce-org&repo=symforce&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/sympy_tutorial.html">SymPy Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/geometry_tutorial.html">Geometry Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/ops_tutorial.html">Ops Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/cameras_tutorial.html">Cameras Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/values_tutorial.html">Values Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/codegen_tutorial.html">Codegen Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/optimization_tutorial.html">Optimization Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/epsilon_tutorial.html">Epsilon Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/bundle_adjustment/README.html">Bundle Adjustment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/bundle_adjustment_fixed_size/README.html">Fixed Size Bundle Adjustment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/bundle_adjustment_in_the_large/README.html">Bundle-Adjustment-in-the-Large</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/custom_factor_generation/README.html">Custom Factor Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/robot_2d_localization/README.html">Robot 2D Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/robot_3d_localization/README.html">Robot 3D Localization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">symforce Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/symforce.html">symforce package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">sym Python Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api-gen-py/sym.html">sym package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">sym C++ Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api-gen-cpp/classlist.html">Class list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api-gen-cpp/filelist.html">File list</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">opt C++ Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api-cpp/classlist.html">Class list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api-cpp/filelist.html">File list</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../../symforce.html">symforce</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Skydio, Inc.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>